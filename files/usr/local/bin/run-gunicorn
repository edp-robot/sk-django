#!/usr/bin/env python
import os
import shlex

PORT = os.environ.get("PORT", "8000")
SETTINGS_MODULE = os.environ["DJANGO_SETTINGS_MODULE"]
PROJECT_PACKAGE = SETTINGS_MODULE.split(".", 1)[0]
WSGI_MODULE = f"{PROJECT_PACKAGE}.wsgi"

# update gunicorn invocation per Google sample application for Google Cloud Run
# https://github.com/GoogleCloudPlatform/python-docs-samples/blob/HEAD/run/helloworld/Dockerfile#L38
args = shlex.split(f"gunicorn --worker-class gevent --timeout 0 --workers 1 --threads 8 --bind 0.0.0.0:{PORT} {WSGI_MODULE}")

os.execlp(args[0], *args)
